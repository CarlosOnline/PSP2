var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
define(["require", "exports", './itemViewModel'], function (require, exports, itemViewModel_1) {
    var FormEditorType;
    (function (FormEditorType) {
        FormEditorType[FormEditorType["None"] = 0] = "None";
        FormEditorType[FormEditorType["Target"] = 1] = "Target";
        FormEditorType[FormEditorType["Common"] = 2] = "Common";
        FormEditorType[FormEditorType["Generic"] = 3] = "Generic";
    })(FormEditorType || (FormEditorType = {}));
    var FormEditor = (function (_super) {
        __extends(FormEditor, _super);
        function FormEditor(app, eventAggregator, utility) {
            var _this = this;
            _super.call(this, app, eventAggregator, utility);
            this.connectWith = null;
            this.url = null;
            this.target = {
                url: "views/psp/data/test.json",
                model: null,
                item: null,
            };
            this.tabs = {
                url: "views/psp/data/tabs.json",
                model: null,
                item: null,
            };
            this.template = null;
            this.commonTab = null;
            this.itemType = itemViewModel_1.ItemType.TemplateEditor;
            this.itemTypeName = itemViewModel_1.ItemType[this.itemType];
            this.app.editor = this;
            g_Editor = this;
            var self = this;
            this.eventAggregator.subscribe("Snippet-bind", function (item) { _this.onSnippetBind(item); });
            this.eventAggregator.subscribe("Component-bind", function (item) { _this.onComponentBind(item); });
            this.eventAggregator.subscribe("SnippetForm-bind", function (item) { _this.onSnippetFormBind(item); });
            this.eventAggregator.subscribe("ComponentForm-bind", function (item) { _this.onComponentFormBind(item); });
            this.eventAggregator.subscribe("Header-bind", function (item) { _this.onHeaderBind(item); });
        }
        FormEditor.prototype.activate = function (params, queryParams, config) {
            console.log("activate", params, queryParams);
            //TODO: get model from data, download data
            var self = this;
            this.utility.loadUrl(this.target.url).then(function (model) {
                model.targetMode = true;
                self.target.model = model;
            });
            this.utility.loadAllTabs(this.tabs.url).then(function (model) {
                self.tabs.model = model;
            });
            var $sortables = $(".sortable");
            if ($sortables.sortable) {
                console.log("Apply sortables");
                $sortables.sortable();
            }
        };
        FormEditor.prototype.updateUiElements = function () {
            console.error("TODO updateUiElements");
        };
        FormEditor.prototype.resizeCoverUp = function (elem) {
            // just make the inputs read only
            // TODO: Remove on render
            //console.log("resizeCoverUp", elem);
            $(".control-component input").prop('readonly', true);
            $(".control-component :checkbox").prop('readonly', true);
            $(".control-component input").addClass("input-cover-up");
            $(".control-component :checkbox").addClass("input-cover-up");
            $(".control-component span.name").addClass("input-cover-up");
            return; // TODO:
            var $elem = $(elem);
            var item = $elem.data("itemViewModel");
            if (!item) {
                console.error("missing itemViewModel", elem);
                return;
            }
            var container = item.element;
            if (!container) {
                console.error("missing itemViewModel element", elem);
                return;
            }
            var $container = $(container);
            var position = $container.offset();
            $elem.offset({ left: position.left, top: position.top, });
            $elem.width($container.width());
            $elem.height($container.height());
            //console.log("resizeCoverUp", position.left, position.top, $container.width(), $container.height(), item.element, elem);
        };
        FormEditor.prototype.resizeCoverUps = function () {
            var self = this;
            $(".cover-up").each(function (idx, elem) {
                self.resizeCoverUp(elem);
            });
        };
        FormEditor.prototype.resizeItemCoverUp = function (item) {
            return;
            if (!item.coverUp)
                return;
            var self = this;
            setTimeout(function () {
                self.resizeCoverUp(item.coverUp);
            }, 0);
        };
        FormEditor.prototype.onSnippetFormBind = function (item) {
            //console.log("onSnippetFormBind", item);
            if (item.model.targetMode) {
                this.target.item = item;
            }
            $(".sortable").sortable();
            this.resizeCoverUps();
        };
        FormEditor.prototype.onSnippetBind = function (item) {
            //console.log("onSnippetBind", item);
            this.resizeItemCoverUp(item);
        };
        FormEditor.prototype.onComponentFormBind = function (item) {
            //console.log("onComponentFormBind", item);
            $(".sortable").sortable();
            this.resizeCoverUps();
        };
        FormEditor.prototype.onComponentBind = function (item) {
            //console.log("onComponentBind", component, component.element);
            this.resizeItemCoverUp(item);
        };
        FormEditor.prototype.onHeaderBind = function (item) {
            this.resizeItemCoverUp(item);
        };
        return FormEditor;
    })(itemViewModel_1.ItemViewModel);
    exports.FormEditor = FormEditor;
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZXdzL3BzcC9mb3JtRWRpdG9yLnRzIl0sIm5hbWVzIjpbIkZvcm1FZGl0b3JUeXBlIiwiRm9ybUVkaXRvciIsIkZvcm1FZGl0b3IuY29uc3RydWN0b3IiLCJGb3JtRWRpdG9yLmFjdGl2YXRlIiwiRm9ybUVkaXRvci51cGRhdGVVaUVsZW1lbnRzIiwiRm9ybUVkaXRvci5yZXNpemVDb3ZlclVwIiwiRm9ybUVkaXRvci5yZXNpemVDb3ZlclVwcyIsIkZvcm1FZGl0b3IucmVzaXplSXRlbUNvdmVyVXAiLCJGb3JtRWRpdG9yLm9uU25pcHBldEZvcm1CaW5kIiwiRm9ybUVkaXRvci5vblNuaXBwZXRCaW5kIiwiRm9ybUVkaXRvci5vbkNvbXBvbmVudEZvcm1CaW5kIiwiRm9ybUVkaXRvci5vbkNvbXBvbmVudEJpbmQiLCJGb3JtRWRpdG9yLm9uSGVhZGVyQmluZCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztJQVlBLElBQUssY0FLSjtJQUxELFdBQUssY0FBYztRQUNmQSxtREFBSUEsQ0FBQUE7UUFDSkEsdURBQU1BLENBQUFBO1FBQ05BLHVEQUFNQSxDQUFBQTtRQUNOQSx5REFBT0EsQ0FBQUE7SUFDWEEsQ0FBQ0EsRUFMSSxjQUFjLEtBQWQsY0FBYyxRQUtsQjtJQVFEO1FBQWdDQyw4QkFBYUE7UUFrQnpDQSxvQkFBWUEsR0FBR0EsRUFBRUEsZUFBZUEsRUFBRUEsT0FBT0E7WUFsQjdDQyxpQkE2SUNBO1lBMUhPQSxrQkFBTUEsR0FBR0EsRUFBRUEsZUFBZUEsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7WUFqQnpDQSxnQkFBV0EsR0FBV0EsSUFBSUEsQ0FBQ0E7WUFDM0JBLFFBQUdBLEdBQVdBLElBQUlBLENBQUNBO1lBQ25CQSxXQUFNQSxHQUFHQTtnQkFDTEEsR0FBR0EsRUFBRUEsMEJBQTBCQTtnQkFDL0JBLEtBQUtBLEVBQUVBLElBQUlBO2dCQUNYQSxJQUFJQSxFQUFnQkEsSUFBSUE7YUFDM0JBLENBQUNBO1lBQ0ZBLFNBQUlBLEdBQUdBO2dCQUNIQSxHQUFHQSxFQUFFQSwwQkFBMEJBO2dCQUMvQkEsS0FBS0EsRUFBRUEsSUFBSUE7Z0JBQ1hBLElBQUlBLEVBQVNBLElBQUlBO2FBQ3BCQSxDQUFDQTtZQUVGQSxhQUFRQSxHQUFnQkEsSUFBSUEsQ0FBQ0E7WUFDN0JBLGNBQVNBLEdBQWdCQSxJQUFJQSxDQUFDQTtZQUkxQkEsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0Esd0JBQVFBLENBQUNBLGNBQWNBLENBQUNBO1lBQ3hDQSxJQUFJQSxDQUFDQSxZQUFZQSxHQUFHQSx3QkFBUUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7WUFDNUNBLElBQUlBLENBQUNBLEdBQUdBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO1lBRXZCQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUNoQkEsSUFBSUEsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7WUFDaEJBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLFNBQVNBLENBQUNBLGNBQWNBLEVBQUVBLFVBQUFBLElBQUlBLElBQU1BLEtBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3RGQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxTQUFTQSxDQUFDQSxnQkFBZ0JBLEVBQUVBLFVBQUFBLElBQUlBLElBQU1BLEtBQUlBLENBQUNBLGVBQWVBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQzFGQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxTQUFTQSxDQUFDQSxrQkFBa0JBLEVBQUVBLFVBQUFBLElBQUlBLElBQU1BLEtBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDOUZBLElBQUlBLENBQUNBLGVBQWVBLENBQUNBLFNBQVNBLENBQUNBLG9CQUFvQkEsRUFBRUEsVUFBQUEsSUFBSUEsSUFBTUEsS0FBSUEsQ0FBQ0EsbUJBQW1CQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNsR0EsSUFBSUEsQ0FBQ0EsZUFBZUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsYUFBYUEsRUFBRUEsVUFBQUEsSUFBSUEsSUFBTUEsS0FBSUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDeEZBLENBQUNBO1FBRURELDZCQUFRQSxHQUFSQSxVQUFTQSxNQUFNQSxFQUFFQSxXQUFXQSxFQUFFQSxNQUFNQTtZQUNoQ0UsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsVUFBVUEsRUFBRUEsTUFBTUEsRUFBRUEsV0FBV0EsQ0FBQ0EsQ0FBQ0E7WUFDN0NBLEFBQ0FBLDBDQUQwQ0E7Z0JBQ3RDQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUVoQkEsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsS0FBS0E7Z0JBQ3RELEtBQUssQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDO2dCQUN4QixJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7WUFDOUIsQ0FBQyxDQUFDQSxDQUFDQTtZQUVIQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxXQUFXQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFVQSxLQUFLQTtnQkFDeEQsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1lBQzVCLENBQUMsQ0FBQ0EsQ0FBQ0E7WUFFSEEsSUFBSUEsVUFBVUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0E7WUFDaENBLEVBQUVBLENBQUNBLENBQUNBLFVBQVVBLENBQUNBLFFBQVFBLENBQUNBLENBQUNBLENBQUNBO2dCQUN0QkEsT0FBT0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxDQUFDQTtnQkFDL0JBLFVBQVVBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1lBQzFCQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUVERixxQ0FBZ0JBLEdBQWhCQTtZQUNJRyxPQUFPQSxDQUFDQSxLQUFLQSxDQUFDQSx1QkFBdUJBLENBQUNBLENBQUNBO1FBQzNDQSxDQUFDQTtRQUVESCxrQ0FBYUEsR0FBYkEsVUFBY0EsSUFBaUJBO1lBQzNCSSxBQUdBQSxpQ0FIaUNBO1lBQ2pDQSx5QkFBeUJBO1lBQ3pCQSxxQ0FBcUNBO1lBQ3JDQSxDQUFDQSxDQUFDQSwwQkFBMEJBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1lBQ3JEQSxDQUFDQSxDQUFDQSw4QkFBOEJBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1lBQ3pEQSxDQUFDQSxDQUFDQSwwQkFBMEJBLENBQUNBLENBQUNBLFFBQVFBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0E7WUFDekRBLENBQUNBLENBQUNBLDhCQUE4QkEsQ0FBQ0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQTtZQUM3REEsQ0FBQ0EsQ0FBQ0EsOEJBQThCQSxDQUFDQSxDQUFDQSxRQUFRQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBO1lBQzdEQSxNQUFNQSxFQUFFQSxRQUFRQTtZQUVoQkEsSUFBSUEsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDcEJBLElBQUlBLElBQUlBLEdBQW1CQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxlQUFlQSxDQUFDQSxDQUFDQTtZQUN2REEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ1JBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLHVCQUF1QkEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQzdDQSxNQUFNQSxDQUFDQTtZQUNYQSxDQUFDQTtZQUVEQSxJQUFJQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQTtZQUM3QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2JBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBLCtCQUErQkEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7Z0JBQ3JEQSxNQUFNQSxDQUFDQTtZQUNYQSxDQUFDQTtZQUVEQSxJQUFJQSxVQUFVQSxHQUFHQSxDQUFDQSxDQUFDQSxTQUFTQSxDQUFDQSxDQUFDQTtZQUM5QkEsSUFBSUEsUUFBUUEsR0FBR0EsVUFBVUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7WUFFbkNBLEtBQUtBLENBQUNBLE1BQU1BLENBQUNBLEVBQUVBLElBQUlBLEVBQUVBLFFBQVFBLENBQUNBLElBQUlBLEVBQUVBLEdBQUdBLEVBQUVBLFFBQVFBLENBQUNBLEdBQUdBLEdBQUdBLENBQUNBLENBQUNBO1lBQzFEQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxDQUFDQTtZQUNoQ0EsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7WUFFbENBLHlIQUF5SEE7UUFDN0hBLENBQUNBO1FBRURKLG1DQUFjQSxHQUFkQTtZQUNJSyxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUNoQkEsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBQ0EsR0FBR0EsRUFBRUEsSUFBaUJBO2dCQUN2Q0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7WUFDN0JBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLENBQUNBO1FBRURMLHNDQUFpQkEsR0FBakJBLFVBQWtCQSxJQUFtQkE7WUFDakNNLE1BQU1BLENBQUNBO1lBQ1BBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBO2dCQUNkQSxNQUFNQSxDQUFDQTtZQUVYQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtZQUNoQkEsVUFBVUEsQ0FBQ0E7Z0JBQ1AsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDckMsQ0FBQyxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNWQSxDQUFDQTtRQUVETixzQ0FBaUJBLEdBQWpCQSxVQUFrQkEsSUFBaUJBO1lBQy9CTyx5Q0FBeUNBO1lBRXpDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDeEJBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1lBQzVCQSxDQUFDQTtZQUVEQSxDQUFDQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtZQUUxQkEsSUFBSUEsQ0FBQ0EsY0FBY0EsRUFBRUEsQ0FBQ0E7UUFDMUJBLENBQUNBO1FBRURQLGtDQUFhQSxHQUFiQSxVQUFjQSxJQUFhQTtZQUN2QlEsQUFDQUEscUNBRHFDQTtZQUNyQ0EsSUFBSUEsQ0FBQ0EsaUJBQWlCQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNqQ0EsQ0FBQ0E7UUFFRFIsd0NBQW1CQSxHQUFuQkEsVUFBb0JBLElBQW1CQTtZQUNuQ1MsQUFDQUEsMkNBRDJDQTtZQUMzQ0EsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7WUFDMUJBLElBQUlBLENBQUNBLGNBQWNBLEVBQUVBLENBQUNBO1FBQzFCQSxDQUFDQTtRQUVEVCxvQ0FBZUEsR0FBZkEsVUFBZ0JBLElBQWVBO1lBQzNCVSxBQUNBQSwrREFEK0RBO1lBQy9EQSxJQUFJQSxDQUFDQSxpQkFBaUJBLENBQUNBLElBQUlBLENBQUNBLENBQUNBO1FBQ2pDQSxDQUFDQTtRQUVEVixpQ0FBWUEsR0FBWkEsVUFBYUEsSUFBWUE7WUFDckJXLElBQUlBLENBQUNBLGlCQUFpQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDakNBLENBQUNBO1FBQ0xYLGlCQUFDQTtJQUFEQSxDQTdJQSxBQTZJQ0EsRUE3SStCLDZCQUFhLEVBNkk1QztJQTdJWSxrQkFBVSxhQTZJdEIsQ0FBQSIsImZpbGUiOiJ2aWV3cy9wc3AvZm9ybUVkaXRvci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvbXB1dGVkRnJvbSwgYmluZGFibGUgfSBmcm9tICdhdXJlbGlhLWZyYW1ld29yayc7XHJcbmltcG9ydCB7IFV0aWxpdHkgfSBmcm9tICcuL2NvbW1vbi91dGlsaXR5JztcclxuaW1wb3J0IHsgSXRlbVR5cGUsIEl0ZW1WaWV3TW9kZWwgfSBmcm9tICcuL2l0ZW1WaWV3TW9kZWwnO1xyXG5pbXBvcnQgeyBTbmlwcGV0Rm9ybSB9IGZyb20gJy4vc25pcHBldC1mb3JtJztcclxuaW1wb3J0IHsgU25pcHBldCB9IGZyb20gJy4vc25pcHBldCc7XHJcbmltcG9ydCB7IENvbXBvbmVudEZvcm0gfSBmcm9tICcuL2NvbXBvbmVudC1mb3JtJztcclxuaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSAnLi9jb21wb25lbnQnO1xyXG5pbXBvcnQgeyBIZWFkZXIgfSBmcm9tICcuL2hlYWRlcic7XHJcbmltcG9ydCB7IFRhYnMgfSBmcm9tICcuL3RhYnMnO1xyXG5cclxuZGVjbGFyZSB2YXIgZ19FZGl0b3I7XHJcblxyXG5lbnVtIEZvcm1FZGl0b3JUeXBlIHtcclxuICAgIE5vbmUsXHJcbiAgICBUYXJnZXQsXHJcbiAgICBDb21tb24sXHJcbiAgICBHZW5lcmljLFxyXG59XHJcblxyXG5pbnRlcmZhY2UgRm9ybUVkaXRvckRhdGEge1xyXG4gICAgdXJsOiBzdHJpbmc7XHJcbiAgICBmb3JtOiBGb3JtRWRpdG9yO1xyXG4gICAgdHlwZTogRm9ybUVkaXRvclR5cGU7XHJcbn1cclxuXHJcbmV4cG9ydCBjbGFzcyBGb3JtRWRpdG9yIGV4dGVuZHMgSXRlbVZpZXdNb2RlbCB7XHJcblxyXG4gICAgY29ubmVjdFdpdGg6IHN0cmluZyA9IG51bGw7XHJcbiAgICB1cmw6IHN0cmluZyA9IG51bGw7XHJcbiAgICB0YXJnZXQgPSB7XHJcbiAgICAgICAgdXJsOiBcInZpZXdzL3BzcC9kYXRhL3Rlc3QuanNvblwiLFxyXG4gICAgICAgIG1vZGVsOiBudWxsLFxyXG4gICAgICAgIGl0ZW06IDxTbmlwcGV0Rm9ybT4gbnVsbCxcclxuICAgIH07XHJcbiAgICB0YWJzID0ge1xyXG4gICAgICAgIHVybDogXCJ2aWV3cy9wc3AvZGF0YS90YWJzLmpzb25cIixcclxuICAgICAgICBtb2RlbDogbnVsbCxcclxuICAgICAgICBpdGVtOiA8VGFicz4gbnVsbCxcclxuICAgIH07XHJcblxyXG4gICAgdGVtcGxhdGU6IFNuaXBwZXRGb3JtID0gbnVsbDtcclxuICAgIGNvbW1vblRhYjogU25pcHBldEZvcm0gPSBudWxsO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGFwcCwgZXZlbnRBZ2dyZWdhdG9yLCB1dGlsaXR5KSB7XHJcbiAgICAgICAgc3VwZXIoYXBwLCBldmVudEFnZ3JlZ2F0b3IsIHV0aWxpdHkpO1xyXG4gICAgICAgIHRoaXMuaXRlbVR5cGUgPSBJdGVtVHlwZS5UZW1wbGF0ZUVkaXRvcjtcclxuICAgICAgICB0aGlzLml0ZW1UeXBlTmFtZSA9IEl0ZW1UeXBlW3RoaXMuaXRlbVR5cGVdO1xyXG4gICAgICAgIHRoaXMuYXBwLmVkaXRvciA9IHRoaXM7XHJcblxyXG4gICAgICAgIGdfRWRpdG9yID0gdGhpcztcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5ldmVudEFnZ3JlZ2F0b3Iuc3Vic2NyaWJlKFwiU25pcHBldC1iaW5kXCIsIGl0ZW0gPT4geyB0aGlzLm9uU25pcHBldEJpbmQoaXRlbSk7IH0pO1xyXG4gICAgICAgIHRoaXMuZXZlbnRBZ2dyZWdhdG9yLnN1YnNjcmliZShcIkNvbXBvbmVudC1iaW5kXCIsIGl0ZW0gPT4geyB0aGlzLm9uQ29tcG9uZW50QmluZChpdGVtKTsgfSk7XHJcbiAgICAgICAgdGhpcy5ldmVudEFnZ3JlZ2F0b3Iuc3Vic2NyaWJlKFwiU25pcHBldEZvcm0tYmluZFwiLCBpdGVtID0+IHsgdGhpcy5vblNuaXBwZXRGb3JtQmluZChpdGVtKTsgfSk7XHJcbiAgICAgICAgdGhpcy5ldmVudEFnZ3JlZ2F0b3Iuc3Vic2NyaWJlKFwiQ29tcG9uZW50Rm9ybS1iaW5kXCIsIGl0ZW0gPT4geyB0aGlzLm9uQ29tcG9uZW50Rm9ybUJpbmQoaXRlbSk7IH0pO1xyXG4gICAgICAgIHRoaXMuZXZlbnRBZ2dyZWdhdG9yLnN1YnNjcmliZShcIkhlYWRlci1iaW5kXCIsIGl0ZW0gPT4geyB0aGlzLm9uSGVhZGVyQmluZChpdGVtKTsgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgYWN0aXZhdGUocGFyYW1zLCBxdWVyeVBhcmFtcywgY29uZmlnKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJhY3RpdmF0ZVwiLCBwYXJhbXMsIHF1ZXJ5UGFyYW1zKTtcclxuICAgICAgICAvL1RPRE86IGdldCBtb2RlbCBmcm9tIGRhdGEsIGRvd25sb2FkIGRhdGFcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgICAgIHRoaXMudXRpbGl0eS5sb2FkVXJsKHRoaXMudGFyZ2V0LnVybCkudGhlbihmdW5jdGlvbiAobW9kZWwpIHtcclxuICAgICAgICAgICAgbW9kZWwudGFyZ2V0TW9kZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlbGYudGFyZ2V0Lm1vZGVsID0gbW9kZWw7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHRoaXMudXRpbGl0eS5sb2FkQWxsVGFicyh0aGlzLnRhYnMudXJsKS50aGVuKGZ1bmN0aW9uIChtb2RlbCkge1xyXG4gICAgICAgICAgICBzZWxmLnRhYnMubW9kZWwgPSBtb2RlbDtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdmFyICRzb3J0YWJsZXMgPSAkKFwiLnNvcnRhYmxlXCIpO1xyXG4gICAgICAgIGlmICgkc29ydGFibGVzLnNvcnRhYmxlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQXBwbHkgc29ydGFibGVzXCIpO1xyXG4gICAgICAgICAgICAkc29ydGFibGVzLnNvcnRhYmxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHVwZGF0ZVVpRWxlbWVudHMoKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlRPRE8gdXBkYXRlVWlFbGVtZW50c1wiKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNpemVDb3ZlclVwKGVsZW06IEhUTUxFbGVtZW50KSB7XHJcbiAgICAgICAgLy8ganVzdCBtYWtlIHRoZSBpbnB1dHMgcmVhZCBvbmx5XHJcbiAgICAgICAgLy8gVE9ETzogUmVtb3ZlIG9uIHJlbmRlclxyXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJyZXNpemVDb3ZlclVwXCIsIGVsZW0pO1xyXG4gICAgICAgICQoXCIuY29udHJvbC1jb21wb25lbnQgaW5wdXRcIikucHJvcCgncmVhZG9ubHknLCB0cnVlKTtcclxuICAgICAgICAkKFwiLmNvbnRyb2wtY29tcG9uZW50IDpjaGVja2JveFwiKS5wcm9wKCdyZWFkb25seScsIHRydWUpO1xyXG4gICAgICAgICQoXCIuY29udHJvbC1jb21wb25lbnQgaW5wdXRcIikuYWRkQ2xhc3MoXCJpbnB1dC1jb3Zlci11cFwiKTtcclxuICAgICAgICAkKFwiLmNvbnRyb2wtY29tcG9uZW50IDpjaGVja2JveFwiKS5hZGRDbGFzcyhcImlucHV0LWNvdmVyLXVwXCIpO1xyXG4gICAgICAgICQoXCIuY29udHJvbC1jb21wb25lbnQgc3Bhbi5uYW1lXCIpLmFkZENsYXNzKFwiaW5wdXQtY292ZXItdXBcIik7XHJcbiAgICAgICAgcmV0dXJuOyAvLyBUT0RPOlxyXG5cclxuICAgICAgICB2YXIgJGVsZW0gPSAkKGVsZW0pO1xyXG4gICAgICAgIHZhciBpdGVtID0gPEl0ZW1WaWV3TW9kZWw+ICRlbGVtLmRhdGEoXCJpdGVtVmlld01vZGVsXCIpO1xyXG4gICAgICAgIGlmICghaXRlbSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwibWlzc2luZyBpdGVtVmlld01vZGVsXCIsIGVsZW0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB2YXIgY29udGFpbmVyID0gaXRlbS5lbGVtZW50O1xyXG4gICAgICAgIGlmICghY29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJtaXNzaW5nIGl0ZW1WaWV3TW9kZWwgZWxlbWVudFwiLCBlbGVtKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdmFyICRjb250YWluZXIgPSAkKGNvbnRhaW5lcik7XHJcbiAgICAgICAgdmFyIHBvc2l0aW9uID0gJGNvbnRhaW5lci5vZmZzZXQoKTtcclxuXHJcbiAgICAgICAgJGVsZW0ub2Zmc2V0KHsgbGVmdDogcG9zaXRpb24ubGVmdCwgdG9wOiBwb3NpdGlvbi50b3AsIH0pO1xyXG4gICAgICAgICRlbGVtLndpZHRoKCRjb250YWluZXIud2lkdGgoKSk7XHJcbiAgICAgICAgJGVsZW0uaGVpZ2h0KCRjb250YWluZXIuaGVpZ2h0KCkpO1xyXG5cclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwicmVzaXplQ292ZXJVcFwiLCBwb3NpdGlvbi5sZWZ0LCBwb3NpdGlvbi50b3AsICRjb250YWluZXIud2lkdGgoKSwgJGNvbnRhaW5lci5oZWlnaHQoKSwgaXRlbS5lbGVtZW50LCBlbGVtKTtcclxuICAgIH1cclxuXHJcbiAgICByZXNpemVDb3ZlclVwcygpIHtcclxuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICAgICAgJChcIi5jb3Zlci11cFwiKS5lYWNoKChpZHgsIGVsZW06IEhUTUxFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICAgIHNlbGYucmVzaXplQ292ZXJVcChlbGVtKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICByZXNpemVJdGVtQ292ZXJVcChpdGVtOiBJdGVtVmlld01vZGVsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIGlmICghaXRlbS5jb3ZlclVwKVxyXG4gICAgICAgICAgICByZXR1cm47XHJcblxyXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5yZXNpemVDb3ZlclVwKGl0ZW0uY292ZXJVcCk7XHJcbiAgICAgICAgfSwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25TbmlwcGV0Rm9ybUJpbmQoaXRlbTogU25pcHBldEZvcm0pIHtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwib25TbmlwcGV0Rm9ybUJpbmRcIiwgaXRlbSk7XHJcblxyXG4gICAgICAgIGlmIChpdGVtLm1vZGVsLnRhcmdldE1vZGUpIHtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXQuaXRlbSA9IGl0ZW07XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAkKFwiLnNvcnRhYmxlXCIpLnNvcnRhYmxlKCk7XHJcblxyXG4gICAgICAgIHRoaXMucmVzaXplQ292ZXJVcHMoKTtcclxuICAgIH1cclxuXHJcbiAgICBvblNuaXBwZXRCaW5kKGl0ZW06IFNuaXBwZXQpIHtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwib25TbmlwcGV0QmluZFwiLCBpdGVtKTtcclxuICAgICAgICB0aGlzLnJlc2l6ZUl0ZW1Db3ZlclVwKGl0ZW0pO1xyXG4gICAgfVxyXG5cclxuICAgIG9uQ29tcG9uZW50Rm9ybUJpbmQoaXRlbTogQ29tcG9uZW50Rm9ybSkge1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJvbkNvbXBvbmVudEZvcm1CaW5kXCIsIGl0ZW0pO1xyXG4gICAgICAgICQoXCIuc29ydGFibGVcIikuc29ydGFibGUoKTtcclxuICAgICAgICB0aGlzLnJlc2l6ZUNvdmVyVXBzKCk7XHJcbiAgICB9XHJcblxyXG4gICAgb25Db21wb25lbnRCaW5kKGl0ZW06IENvbXBvbmVudCkge1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJvbkNvbXBvbmVudEJpbmRcIiwgY29tcG9uZW50LCBjb21wb25lbnQuZWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5yZXNpemVJdGVtQ292ZXJVcChpdGVtKTtcclxuICAgIH1cclxuXHJcbiAgICBvbkhlYWRlckJpbmQoaXRlbTogSGVhZGVyKSB7XHJcbiAgICAgICAgdGhpcy5yZXNpemVJdGVtQ292ZXJVcChpdGVtKTtcclxuICAgIH1cclxufVxyXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=