define(["require", "exports", 'aurelia-http-client'], function (require, exports, aurelia_http_client_1) {
    var BaseUtility = (function () {
        function BaseUtility(http) {
            this.http = http;
        }
        BaseUtility.prototype.loadUrl = function (url) {
            var _this = this;
            var self = this;
            return this.http.get(url).then(function (response) {
                var model = response.content;
                return _this.loadReference(model);
            });
        };
        BaseUtility.prototype.loadReference = function (model) {
            var _this = this;
            return new Promise(function (resolve, reject) {
                if (!model || !model.reference || model.url) {
                    resolve(model);
                    return;
                }
                _this.http.get('/views/psp/data/' + model.reference).then(function (response) {
                    var data = response.content;
                    var found = data.find(function (item) { return item.title == model.title; });
                    if (!found) {
                        console.error('missing component ' + model.reference + "!" + model.title);
                        reject('missing component ' + model.reference + "!" + model.title);
                    }
                    if (found.hidden) {
                        resolve(null);
                    }
                    Object.assign(model, found);
                    resolve(model);
                });
            });
        };
        BaseUtility.prototype.loadTabUrl = function (url, index, tabModel) {
            var self = this;
            return this.http.get(url).then(function (response) {
                var model = response.content;
                return model.hidden ? null : model;
            })
                .then(function (model) {
                if (model == null)
                    return null;
                var models = model;
                models = models.filter(function (item) {
                    return !item.hidden;
                });
                return self.loadReference(model).then(function (response) {
                    var model = response;
                    if (model.hidden)
                        return null;
                    model.index = index;
                    var models = model;
                    models = models.filter(function (item) {
                        return !item.hidden;
                    });
                    tabModel.tabs = models;
                    return tabModel;
                });
            });
        };
        BaseUtility.prototype.loadAllTabs = function (url) {
            //console.log("loadAllTabs", url);
            var self = this;
            // load tabs.json
            return this.http.get(url).then(function (response) {
                var data = response.content;
                var promises = [];
                for (var idx = 0; idx < data.length; idx++) {
                    var model = data[idx];
                    if (model.hidden)
                        continue;
                    // load test.json
                    var url_1 = "./views/psp/data/" + model.json;
                    promises.push(self.loadTabUrl(url_1, idx, model));
                }
                ;
                return Promise.all(promises).then(function (results) {
                    var models = [];
                    for (var _i = 0; _i < results.length; _i++) {
                        var result = results[_i];
                        if (result && !result.hidden)
                            models.push(result);
                    }
                    models.sort(function (left, right) {
                        if (left.index == right.index)
                            return 0;
                        return (left.index < right.index) ? -1 : 1;
                    });
                    return models;
                });
            });
        };
        BaseUtility.findParent = function ($elem, selector) {
            var parent = $elem.parent(selector);
            while (parent && parent[0] == null) {
                $elem = $elem.parent();
                if ($elem[0] == null)
                    return null;
                parent = $elem.parent(selector);
            }
            return parent;
        };
        BaseUtility.inject = [aurelia_http_client_1.HttpClient];
        return BaseUtility;
    })();
    exports.BaseUtility = BaseUtility;
    var Extensions;
    (function (Extensions) {
        var ArrayExt;
        (function (ArrayExt) {
            function insert(index, item) {
                this.splice(index, 0, item);
            }
            ArrayExt.insert = insert;
            ;
            function removeAll(thisArg) {
                thisArg = thisArg || this;
                while (thisArg.length > 0)
                    thisArg.pop();
            }
            ArrayExt.removeAll = removeAll;
            // TODO: Fix?
            function remove(elem, thisArg) {
                thisArg = thisArg || this;
                var idx = thisArg.indexOf(elem);
                if (idx >= 0 && idx < thisArg.length)
                    return thisArg.slice(idx, 1);
                return null;
            }
            ArrayExt.remove = remove;
            function indexOf(elem, thisArg) {
                thisArg = thisArg || this;
                var idx = thisArg.indexOf(elem);
                return idx;
            }
            ArrayExt.indexOf = indexOf;
            //Array.prototype.insert = ArrayExt.insert;
            //Array.prototype.first = ArrayExt.first;
            Array.prototype.remove = ArrayExt.remove;
        })(ArrayExt = Extensions.ArrayExt || (Extensions.ArrayExt = {}));
        var StringExt;
        (function (StringExt) {
            function hashCode() {
                var hash = 0, i, chr, len;
                if (this.length == 0)
                    return hash;
                for (i = 0, len = this.length; i < len; i++) {
                    chr = this.charCodeAt(i);
                    hash = ((hash << 5) - hash) + chr;
                    hash |= 0; // Convert to 32bit integer
                }
                return hash;
            }
            StringExt.hashCode = hashCode;
            ;
        })(StringExt = Extensions.StringExt || (Extensions.StringExt = {}));
    })(Extensions || (Extensions = {}));
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZpZXdzL21pc2MvdXRpbGl0eS50cyJdLCJuYW1lcyI6WyJCYXNlVXRpbGl0eSIsIkJhc2VVdGlsaXR5LmNvbnN0cnVjdG9yIiwiQmFzZVV0aWxpdHkubG9hZFVybCIsIkJhc2VVdGlsaXR5LmxvYWRSZWZlcmVuY2UiLCJCYXNlVXRpbGl0eS5sb2FkVGFiVXJsIiwiQmFzZVV0aWxpdHkubG9hZEFsbFRhYnMiLCJCYXNlVXRpbGl0eS5maW5kUGFyZW50IiwiRXh0ZW5zaW9ucyIsIkV4dGVuc2lvbnMuQXJyYXlFeHQiLCJFeHRlbnNpb25zLkFycmF5RXh0Lmluc2VydCIsIkV4dGVuc2lvbnMuQXJyYXlFeHQucmVtb3ZlQWxsIiwiRXh0ZW5zaW9ucy5BcnJheUV4dC5yZW1vdmUiLCJFeHRlbnNpb25zLkFycmF5RXh0LmluZGV4T2YiLCJFeHRlbnNpb25zLlN0cmluZ0V4dCIsIkV4dGVuc2lvbnMuU3RyaW5nRXh0Lmhhc2hDb2RlIl0sIm1hcHBpbmdzIjoiO0lBRUE7UUFLRUEscUJBQVlBLElBQWdCQTtZQUMxQkMsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDbkJBLENBQUNBO1FBRURELDZCQUFPQSxHQUFQQSxVQUFRQSxHQUFXQTtZQUFuQkUsaUJBT0NBO1lBTkNBLElBQUlBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO1lBRWhCQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxVQUFBQSxRQUFRQTtnQkFDckNBLElBQUlBLEtBQUtBLEdBQUdBLFFBQVFBLENBQUNBLE9BQU9BLENBQUNBO2dCQUM3QkEsTUFBTUEsQ0FBQ0EsS0FBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7WUFDbkNBLENBQUNBLENBQUNBLENBQUNBO1FBQ0xBLENBQUNBO1FBRURGLG1DQUFhQSxHQUFiQSxVQUFjQSxLQUFLQTtZQUFuQkcsaUJBd0JD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dHkuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwQ2xpZW50IH0gZnJvbSAnYXVyZWxpYS1odHRwLWNsaWVudCc7XHJcblxyXG5leHBvcnQgY2xhc3MgQmFzZVV0aWxpdHkge1xyXG4gIHN0YXRpYyBpbmplY3QgPSBbSHR0cENsaWVudF07XHJcblxyXG4gIGh0dHA6IEh0dHBDbGllbnQ7XHJcblxyXG4gIGNvbnN0cnVjdG9yKGh0dHA6IEh0dHBDbGllbnQpIHtcclxuICAgIHRoaXMuaHR0cCA9IGh0dHA7XHJcbiAgfVxyXG5cclxuICBsb2FkVXJsKHVybDogc3RyaW5nKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQodXJsKS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgdmFyIG1vZGVsID0gcmVzcG9uc2UuY29udGVudDtcclxuICAgICAgcmV0dXJuIHRoaXMubG9hZFJlZmVyZW5jZShtb2RlbCk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxvYWRSZWZlcmVuY2UobW9kZWwpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcblxyXG4gICAgICBpZiAoIW1vZGVsIHx8ICFtb2RlbC5yZWZlcmVuY2UgfHwgbW9kZWwudXJsKSB7XHJcbiAgICAgICAgcmVzb2x2ZShtb2RlbCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLmh0dHAuZ2V0KCcvdmlld3MvcHNwL2RhdGEvJyArIG1vZGVsLnJlZmVyZW5jZSkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgICAgdmFyIGRhdGEgPSA8QXJyYXk8YW55Pj4gcmVzcG9uc2UuY29udGVudDtcclxuICAgICAgICB2YXIgZm91bmQgPSBkYXRhLmZpbmQoKGl0ZW0pID0+IGl0ZW0udGl0bGUgPT0gbW9kZWwudGl0bGUpO1xyXG4gICAgICAgIGlmICghZm91bmQpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ21pc3NpbmcgY29tcG9uZW50ICcgKyBtb2RlbC5yZWZlcmVuY2UgKyBcIiFcIiArIG1vZGVsLnRpdGxlKTtcclxuICAgICAgICAgIHJlamVjdCgnbWlzc2luZyBjb21wb25lbnQgJyArIG1vZGVsLnJlZmVyZW5jZSArIFwiIVwiICsgbW9kZWwudGl0bGUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGZvdW5kLmhpZGRlbikge1xyXG4gICAgICAgICAgcmVzb2x2ZShudWxsKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIE9iamVjdC5hc3NpZ24obW9kZWwsIGZvdW5kKTtcclxuICAgICAgICByZXNvbHZlKG1vZGVsKTtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxvYWRUYWJVcmwodXJsOiBzdHJpbmcsIGluZGV4OiBudW1iZXIsIHRhYk1vZGVsOiBhbnkpIHtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0KHVybCkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICAgIHZhciBtb2RlbCA9IHJlc3BvbnNlLmNvbnRlbnQ7XHJcbiAgICAgIHJldHVybiBtb2RlbC5oaWRkZW4gPyBudWxsIDogbW9kZWw7XHJcbiAgICB9KVxyXG4gICAgLnRoZW4obW9kZWwgPT4ge1xyXG4gICAgICBpZiAobW9kZWwgPT0gbnVsbClcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgIHZhciBtb2RlbHMgPSA8QXJyYXk8YW55Pj4gbW9kZWw7XHJcbiAgICAgIG1vZGVscyA9IG1vZGVscy5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICFpdGVtLmhpZGRlbjtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gc2VsZi5sb2FkUmVmZXJlbmNlKG1vZGVsKS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgICAgICB2YXIgbW9kZWw6IGFueSA9IHJlc3BvbnNlO1xyXG4gICAgICAgIGlmIChtb2RlbC5oaWRkZW4pXHJcbiAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICBtb2RlbC5pbmRleCA9IGluZGV4O1xyXG5cclxuICAgICAgICB2YXIgbW9kZWxzID0gPEFycmF5PGFueT4+IG1vZGVsO1xyXG4gICAgICAgIG1vZGVscyA9IG1vZGVscy5maWx0ZXIoaXRlbSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gIWl0ZW0uaGlkZGVuO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0YWJNb2RlbC50YWJzID0gbW9kZWxzO1xyXG4gICAgICAgIHJldHVybiB0YWJNb2RlbDtcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGxvYWRBbGxUYWJzKHVybCkge1xyXG4gICAgLy9jb25zb2xlLmxvZyhcImxvYWRBbGxUYWJzXCIsIHVybCk7XHJcblxyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG5cclxuICAgIC8vIGxvYWQgdGFicy5qc29uXHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldCh1cmwpLnRoZW4ocmVzcG9uc2UgPT4ge1xyXG4gICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmNvbnRlbnQ7XHJcbiAgICAgIHZhciBwcm9taXNlcyA9IFtdO1xyXG5cclxuICAgICAgZm9yIChsZXQgaWR4ID0gMDsgaWR4IDwgZGF0YS5sZW5ndGg7IGlkeCsrKSB7XHJcbiAgICAgICAgbGV0IG1vZGVsID0gZGF0YVtpZHhdO1xyXG4gICAgICAgIGlmIChtb2RlbC5oaWRkZW4pXHJcbiAgICAgICAgICBjb250aW51ZTtcclxuXHJcbiAgICAgICAgLy8gbG9hZCB0ZXN0Lmpzb25cclxuICAgICAgICBsZXQgdXJsID0gXCIuL3ZpZXdzL3BzcC9kYXRhL1wiICsgbW9kZWwuanNvbjtcclxuICAgICAgICBwcm9taXNlcy5wdXNoKHNlbGYubG9hZFRhYlVybCh1cmwsIGlkeCwgbW9kZWwpKTtcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHJldHVybiBQcm9taXNlLmFsbChwcm9taXNlcykudGhlbihyZXN1bHRzID0+IHtcclxuICAgICAgICBsZXQgbW9kZWxzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgcmVzdWx0IG9mIHJlc3VsdHMpIHtcclxuICAgICAgICAgIGlmIChyZXN1bHQgJiYgIXJlc3VsdC5oaWRkZW4pXHJcbiAgICAgICAgICAgIG1vZGVscy5wdXNoKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBtb2RlbHMuc29ydCgobGVmdCwgcmlnaHQpID0+IHtcclxuICAgICAgICAgIGlmIChsZWZ0LmluZGV4ID09IHJpZ2h0LmluZGV4KVxyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgIHJldHVybiAobGVmdC5pbmRleCA8IHJpZ2h0LmluZGV4KSA/IC0xIDogMTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1vZGVscztcclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHN0YXRpYyBmaW5kUGFyZW50KCRlbGVtOiBKUXVlcnksIHNlbGVjdG9yOiBzdHJpbmcpIHtcclxuICAgIHZhciBwYXJlbnQgPSAkZWxlbS5wYXJlbnQoc2VsZWN0b3IpO1xyXG4gICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnRbMF0gPT0gbnVsbCkge1xyXG4gICAgICAkZWxlbSA9ICRlbGVtLnBhcmVudCgpO1xyXG4gICAgICBpZiAoJGVsZW1bMF0gPT0gbnVsbClcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuXHJcbiAgICAgIHBhcmVudCA9ICRlbGVtLnBhcmVudChzZWxlY3Rvcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGFyZW50O1xyXG4gIH1cclxufVxyXG5cclxubW9kdWxlIEV4dGVuc2lvbnMge1xyXG4gIGV4cG9ydCBtb2R1bGUgQXJyYXlFeHQge1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGluc2VydChpbmRleCwgaXRlbSkge1xyXG4gICAgICB0aGlzLnNwbGljZShpbmRleCwgMCwgaXRlbSk7XHJcbiAgICB9O1xyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiByZW1vdmVBbGw8VD4odGhpc0FyZz86IEFycmF5PFQ+KSB7XHJcbiAgICAgIHRoaXNBcmcgPSB0aGlzQXJnIHx8IHRoaXM7XHJcbiAgICAgIHdoaWxlICh0aGlzQXJnLmxlbmd0aCA+IDApXHJcbiAgICAgICAgdGhpc0FyZy5wb3AoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBUT0RPOiBGaXg/XHJcbiAgICBleHBvcnQgZnVuY3Rpb24gcmVtb3ZlPFQ+KGVsZW06IFQsIHRoaXNBcmc/OiBBcnJheTxUPik6IEFycmF5PFQ+IHtcclxuICAgICAgdGhpc0FyZyA9IHRoaXNBcmcgfHwgdGhpcztcclxuICAgICAgdmFyIGlkeCA9IHRoaXNBcmcuaW5kZXhPZihlbGVtKTtcclxuICAgICAgaWYgKGlkeCA+PSAwICYmIGlkeCA8IHRoaXNBcmcubGVuZ3RoKVxyXG4gICAgICAgIHJldHVybiB0aGlzQXJnLnNsaWNlKGlkeCwgMSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGV4cG9ydCBmdW5jdGlvbiBpbmRleE9mPFQ+KGVsZW06IFQsIHRoaXNBcmc/OiBBcnJheTxUPikge1xyXG4gICAgICB0aGlzQXJnID0gdGhpc0FyZyB8fCB0aGlzO1xyXG4gICAgICB2YXIgaWR4ID0gdGhpc0FyZy5pbmRleE9mKGVsZW0pO1xyXG4gICAgICByZXR1cm4gaWR4O1xyXG4gICAgfVxyXG5cclxuICAgIC8vQXJyYXkucHJvdG90eXBlLmluc2VydCA9IEFycmF5RXh0Lmluc2VydDtcclxuICAgIC8vQXJyYXkucHJvdG90eXBlLmZpcnN0ID0gQXJyYXlFeHQuZmlyc3Q7XHJcbiAgICBBcnJheS5wcm90b3R5cGUucmVtb3ZlID0gQXJyYXlFeHQucmVtb3ZlO1xyXG4gICAgLy9BcnJheS5wcm90b3R5cGUucmVtb3ZlQWxsID0gQXJyYXlFeHQucmVtb3ZlQWxsO1xyXG4gIH1cclxuXHJcbiAgZXhwb3J0IG1vZHVsZSBTdHJpbmdFeHQge1xyXG4gICAgZXhwb3J0IGZ1bmN0aW9uIGhhc2hDb2RlKCkge1xyXG4gICAgICB2YXIgaGFzaCA9IDAsIGksIGNociwgbGVuO1xyXG4gICAgICBpZiAodGhpcy5sZW5ndGggPT0gMCkgcmV0dXJuIGhhc2g7XHJcbiAgICAgIGZvciAoaSA9IDAsIGxlbiA9IHRoaXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICBjaHIgPSB0aGlzLmNoYXJDb2RlQXQoaSk7XHJcbiAgICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgY2hyO1xyXG4gICAgICAgIGhhc2ggfD0gMDsgLy8gQ29udmVydCB0byAzMmJpdCBpbnRlZ2VyXHJcbiAgICAgIH1cclxuICAgICAgcmV0dXJuIGhhc2g7XHJcbiAgICB9O1xyXG4gIH1cclxufVxyXG5cclxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9